# Insights Generation Workflow

## ⚠️ Important: Insights Are NOT Auto-Generated

**Insights are only created when you run the agents workflow.** Building the RAG index does NOT automatically generate insights.

## Current Status

Based on your logs:
- ✅ Project created (project_id=4)
- ✅ RFP uploaded (document_id=4)
- ✅ RAG index built (2 chunks indexed)
- ❌ **Insights NOT generated** (404 is expected)

## Why 404?

The 404 error is **correct behavior**. Insights don't exist yet because:
1. Building the RAG index only creates vector embeddings
2. Insights are created by running the **agents workflow**
3. The agents workflow analyzes the RFP and generates insights

## How to Generate Insights

### Step 1: Run Agents Workflow

```http
POST /agents/run-all
Content-Type: application/json
Authorization: Bearer YOUR_TOKEN

{
  "project_id": 4,
  "rfp_document_id": 4
}
```

### Step 2: Wait for Completion

The workflow will:
1. Analyze RFP document
2. Extract challenges
3. Generate discovery questions
4. Create value propositions
5. Match case studies
6. Build proposal draft
7. **Save insights to database** ← This creates the insights record

### Step 3: Check Status

```http
GET /insights/status?project_id=4
```

This will tell you if insights exist:
```json
{
  "exists": true,
  "project_id": 4,
  "message": "Insights are available. Use /insights/get to retrieve them."
}
```

### Step 4: Get Insights

```http
GET /insights/get?project_id=4
```

## Complete Workflow Diagram

```
1. Create Project
   POST /projects/create
   ↓
2. Upload RFP Document
   POST /upload/rfp?project_id=4
   ↓
3. Build RAG Index
   POST /rag/build-index
   { "rfp_document_id": 4 }
   ↓
4. ⚠️ RUN AGENTS WORKFLOW ⚠️
   POST /agents/run-all
   {
     "project_id": 4,
     "rfp_document_id": 4
   }
   ↓
5. Get Insights
   GET /insights/get?project_id=4
```

## Verification

### Check if Insights Exist

```http
GET /insights/status?project_id=4
```

### Check RAG Status

```http
GET /rag/status/4
```

This shows:
- How many RFP documents are uploaded
- How many are indexed
- Whether insights exist
- What the next step is

## Troubleshooting

### Q: Why do I get 404 on insights?
**A:** Because insights haven't been generated yet. Run `/agents/run-all` first.

### Q: Do I need to run agents workflow every time?
**A:** Yes, for each project. The workflow analyzes the RFP and generates project-specific insights.

### Q: Can I skip the agents workflow?
**A:** No. Insights are only created by the agents workflow. The RAG index is just for document search/chat.

### Q: How long does the workflow take?
**A:** Depends on document size and LLM response time. Usually 30-60 seconds for a typical RFP.

## Summary

**The 404 is NOT a bug - it's expected behavior.**

Insights are generated by running:
```
POST /agents/run-all
{
  "project_id": 4,
  "rfp_document_id": 4
}
```

After this completes, insights will be available and the 404 will be resolved.

